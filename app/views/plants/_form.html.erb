<%= form_with(model: @plant, url: yield(:url), local: true) do |f| %>
  <%= render "shared/error_messages", object: @plant %>
  
  <%= f.label :name, class: "label-#{yield(:class_text)} required-form" %>
  <% if params[:plant] %>
    <%= f.text_field :name, value: params[:plant][:name], maxlength: 30, class: "form-control", required: "required" %>
  <% else %>
    <%= f.text_field :name, maxlength: 30, class: "form-control", required: "required" %>
  <% end %>
  
  <div class="row">
    <div class="col-xs-9 form-zip-left">
      <%= f.label :zipcode, "住所検索", class: "label-#{yield(:class_text)}" %>
      <% if @zipcode %>
        <%= f.text_field :zipcode, value: @zipcode, maxlength: 8, class: "form-control", placeholder: "郵便番号を入力" %>
      <% else %>
        <%= f.text_field :zipcode, maxlength: 8, class: "form-control", placeholder: "郵便番号を入力" %>
      <% end %>
    </div>
    <div class="col-xs-3 form-zip-right">
      <%= f.submit "検索", name: "zip_search_button", class: "btn btn-md btn-primary btn-block" %>
    </div>
  </div>
  
  <%= f.label :address, class: "label-#{yield(:class_text)}" %>
  <% if params[:plant] && @zipcode %>
    <%= f.text_field :address, value: @result_address, maxlength: 50, class: "form-control" %>
  <% elsif params[:plant] %>
    <%= f.text_field :address, value: params[:plant][:address], maxlength: 50, class: "form-control" %>
  <% else %>
    <%= f.text_field :address, maxlength: 50, class: "form-control" %>
  <% end %>
  
  <div class="row">
    <div class="col-xs-6 col-md-6">
      <%= f.label :tel_1, class: "label-#{yield(:class_text)}" %>
      <% if params[:plant] %>
        <%= f.telephone_field :tel_1, value: params[:plant][:tel_1], maxlength: 11, class: "form-control", placeholder: "半角数字10~11桁" %>
      <% else %>
        <%= f.telephone_field :tel_1, maxlength: 11, class: "form-control", placeholder: "半角数字10~11桁" %>
      <% end %>
      <div class="form-alert tel1-alert">電話番号形式で入力してください。</div>
    </div>
    
    <div class="col-xs-6 col-md-6"> 
      <%= f.label :tel_2, class: "label-#{yield(:class_text)}" %>
      <% if params[:plant] %>
        <%= f.telephone_field :tel_2, value: params[:plant][:tel_2], maxlength: 11, class: "form-control", placeholder: "半角数字10~11桁" %>
      <% else %>
        <%= f.telephone_field :tel_2, maxlength: 11, class: "form-control", placeholder: "半角数字10~11桁" %>
      <% end %>
      <div class="form-alert tel2-alert">電話番号形式で入力してください。</div>
    </div>
  </div>
  
  <%= f.label :fax, class: "label-#{yield(:class_text)}" %>
  <% if params[:plant] %>
    <%= f.telephone_field :fax, value: params[:plant][:fax], maxlength: 10, class: "form-control", placeholder: "半角数字10桁" %>
  <% else %>
    <%= f.telephone_field :fax, maxlength: 10, class: "form-control", placeholder: "半角数字10桁" %>
  <% end %>
  <div class="form-alert fax-alert">FAX番号形式で入力してください。</div>
  
  <%= f.label :email, class: "label-#{yield(:class_text)}" %>
  <% if params[:plant] %>
    <%= f.text_field :email, value: params[:plant][:email], maxlength: 254, class: "form-control", placeholder: "example@email.com" %>
  <% else %>
    <%= f.text_field :email, maxlength: 254, class: "form-control", placeholder: "example@email.com" %>
  <% end %>
  <div class="form-alert email-alert">メールアドレス形式で入力してください。</div>
  
  <div class="row">
    <div class="col-xs-6 col-md-6">
      <%= f.label :staff_1, class: "label-#{yield(:class_text)}" %>
      <% if params[:plant] %>
        <%= f.text_field :staff_1, value: params[:plant][:staff_1], maxlength: 30, class: "form-control" %>
      <% else %>
        <%= f.text_field :staff_1, maxlength: 30, class: "form-control" %>
      <% end %>
    </div>
    
    <div class="col-xs-6 col-md-6">   
      <%= f.label :staff_2, class: "label-#{yield(:class_text)}" %>
      <% if params[:plant] %>
        <%= f.text_field :staff_2, value: params[:plant][:staff_2], maxlength: 30, class: "form-control" %>
      <% else %>
        <%= f.text_field :staff_2, maxlength: 30, class: "form-control" %>
      <% end %>
    </div>
  </div>
  
  <%= f.label :note, class: "label-#{yield(:class_text)}" %>
  <% if params[:plant] %>
    <%= f.text_field :note, value: params[:plant][:note], maxlength: 100, class: "form-control" %>
  <% else %>
    <%= f.text_field :note, maxlength: 100, class: "form-control" %>
  <% end %>
  
  <div class="plant-submit-area">
    <%= f.submit yield(:button_text), class: "btn btn-primary btn-md", id: "plant-submit" %>
    <%= link_to :back do %>
      <button class="btn btn-md btn-default">戻る</button>
    <% end %>
  </div>
<% end %>

<script>

$(document).on('turbolinks:load', function() {
  
  // フォームのバリデーション
  
  const tel_1 = $('input[name="plant[tel_1]"]');
  const tel_2 = $('input[name="plant[tel_2]"]');
  const fax = $('input[name="plant[fax]"]');
  const email = $('input[name="plant[email]"]');
  
  function tel1Checker() {
    if(!tel_1.val() || tel_1.val().match(/^[ 　\r\n\t]*$/) || tel_1.val().match(/^\d{10,11}$/)) {
      $('.tel1-alert').css('display', 'none');
    } else {
      $('.tel1-alert').css('display', 'block');
    }
  };
  
  function tel2Checker() {
    if(!tel_2.val() || tel_2.val().match(/^[ 　\r\n\t]*$/) || tel_2.val().match(/^\d{10,11}$/)) {
      $('.tel2-alert').css('display', 'none');
    } else {
      $('.tel2-alert').css('display', 'block');
    }
  };
  
  function faxChecker() {
    if(!fax.val() || fax.val().match(/^[ 　\r\n\t]*$/) || fax.val().match(/^\d{10}$/)) {
      $('.fax-alert').css('display', 'none');
    } else {
      $('.fax-alert').css('display', 'block');
    }
  };
  
  function emailChecker() {
    if(!email.val() || email.val().match(/^[ 　\r\n\t]*$/) || email.val().match(/^[\w+\-.]+@[a-z\d\-.]+\.[a-z]+$/)) {
      $('.email-alert').css('display', 'none');
    } else {
      $('.email-alert').css('display', 'block');
    }
  }
  
  $(tel_1).blur(function() {
    tel1Checker();
  });
  
  $(tel_2).blur(function() {
    tel2Checker();
  });
  
  $(fax).blur(function() {
    faxChecker();
  });
  
  $(email).blur(function() {
    emailChecker();
  });
  
  $('#plant-submit').on('click', function() {
    tel1Checker();
    tel2Checker();
    faxChecker();
    emailChecker();
    $('.form-alert').each(function() {
      if($(this).css('display') == 'block') {
        event.preventDefault();
      }
    });
  });
  
  // 郵便番号検索時はrequired削除
  
  $('input[name="zip_search_button"]').on('click', function() {
    $('input[name="plant[name]"]').removeAttr("required");
  });

});

</script>